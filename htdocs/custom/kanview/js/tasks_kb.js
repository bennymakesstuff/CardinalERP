document.write('<div id="messages"></div>'),document.write('<div id="waitingPopUp"></div>'),document.write('<div id="kanbanTasks"></div>');var o=null,r=null,l=null,s=null,c=null,d=null,e="7100f2bf7f",t="85bd6008d9",u=parent1,f=parent2,p=document.URL,g=mytitle,k="053065326f",n="4ca0de651a",m="NER",a="#mainmenua_"+f+" > span:nth-child(1)",h=$(a).text();function v(e,n,a){var t={action:e,data:{rowid:n,progress:a}};if($("#waitingPopUp").ejWaitingPopup().data("ejWaitingPopup").show(),p.indexOf(f)<0)throw m;return $.ajax({url:document.URL,type:"POST",data:"token="+token+"&postData="+JSON.stringify(t),dataType:"html",async:!1,success:function(t,e){if(transform(h).indexOf(k)<0)throw m;try{var i=JSON.parse(t);if(token=i.token,"OK"!==i.status)return $.jnotify(i.message,"warning",5e3),$("#kanbanTasks").find(".e-targetclone").remove(),$("body").css("cursor","default"),!1;if(r.dataSource.json.forEach(function(e){e.rowid==n&&(e.progress=a+"%",e.task_status=i.data.task_status,e.progress_level=i.data.progress_level)}),p.indexOf(u)<0)throw m;return o.refresh(),$(".badge").each(function(e){void 0!==i.data.kanbanHeaderCounts[this.id]&&(this.textContent=i.data.kanbanHeaderCounts[this.id])}),window.setTimeout(function(){$("#"+n).css("border-color","magenta")},100),null!=l&&l.close(),!0}catch(e){return null!=d&&(d.cancel=!0),errText=$("<div>"+t+"</div>").text().trim(),$.jnotify(e,"error",5e3),console.log(errText),!1}},error:function(e,t,i){return null!=d&&(d.cancel=!0),$.jnotify(i,"error",5e3),!1},complete:function(e,t){$("#waitingPopUp").ejWaitingPopup().data("ejWaitingPopup").hide()}}),!0}$(function(){r=ej.DataManager(kanbanData),o=$("#kanbanTasks").ejKanban({enableTotalCount:enableNativeTotalCount,dataSource:r,locale:sfLocale,enableRTL:!1,columns:columns,keyField:"progress_level",fields:{content:"ref_libelle",primaryKey:"rowid",priority:"priority",tag:tasks_tag,title:"",color:"task_status",imageUrl:"undefined"!=typeof fieldImageUrl&&""!=fieldImageUrl?fieldImageUrl:null,collapsibleCards:{field:"",key:""}},cardSettings:{template:"",colorMapping:colorMapping,externalDropTarget:""},contextMenuSettings:{enable:!0,menuItems:[],customMenuItems:[{text:msgPrintKanbanView,target:ej.Kanban.Target.Header,template:""}]},cardDragStop:function(e){p.indexOf(u)<0&&this.destroy(),tooltipsActive=!1,s=(c=d=e).data[0][0];var t=$(e.draggedElement).prop("id"),i=$(e.draggedElement).parent().data("ej-mappingkey"),n=$(e.dropTarget).parent().data("ej-mappingkey");if(h!==g)throw m;if(void 0===i||void 0===n)return e.cancel=!0,$("#kanbanTasks").find(".e-targetclone").remove(),void $("body").css("cursor","default");if(n===i)return e.cancel=!0,$("#kanbanTasks").find(".e-targetclone").remove(),void $("body").css("cursor","default");if("TASK_DONE"!=n&&"TASK_NOT_STARTED"!=n){if(e.cancel=!0,p.indexOf(u)<0)throw m;return a.setValue(parseInt(s.progress)),void(null!=l&&l.open())}if("TASK_DONE"!=n)if("TASK_NOT_STARTED"!=n);else{if(e.cancel=!0,p.indexOf(u)<0)throw m;v("kanbanTasks_cardDragStop",t,0)}else{if(e.cancel=!0,h!==g)throw m;v("kanbanTasks_cardDragStop",t,100)}},cardDrop:function(e){if(h!==g)throw m},cardClick:function(e){if(s=e.data[0],c=e,p.indexOf(f)<0)throw m;if(!tooltipsActive){var t=r.dataSource.json.length,n=-1,a="";for(i=0;i<t;i++)n=r.dataSource.json[i].rowid,a=r.dataSource.json[i].tooltip_content,$("#task-"+n).ejTooltip({content:a}),n==s.rowid&&($(".tooltip-progress-"+n).each(function(e){$(this).text(r.dataSource.json[i].progress)}),$(".tooltip-ref-"+n).each(function(e){$(this).text(r.dataSource.json[i].ref)}));tooltipsActive=!0}},contextClick:function(e){if(p.indexOf(f)<0)throw m;"ejMenuClick"!=e.type&&"contextClick"!=e.type||e.text!=msgPrintKanbanView||this.print()},create:function(e){},queryCellInfo:function(e){DOL_VERSION;if(p.indexOf(f)<0)throw m;$(e.card).find("td.e-imagecell").html("");var t=e.data.rowid;if(void 0!==tasksResources[t]&&null!=tasksResources[t]){var i="",n=$(e.card).find("td.e-imagecell");tasksResources[t].forEach(function(e){i="","TASKEXECUTIVE"==e.taskResourceType&&(i="taskexecutive"),0<e.taskResourceIdWithSource.indexOf("-I")?n.append('<div class="e-card_link">\n                                  <a href="'+DOL_URL_ROOT+"/user/card.php?id="+e.taskResourceId+'" title="'+e.taskResourceName+'" target="_blank">\n                                    <div class="e-card_image">\n                                       <img class="e-image '+i+'" src="'+DOL_URL_ROOT+"/viewimage.php?modulepart=user&file="+e.taskResourceId+"/0/"+encodeURI(e.taskResourcePhoto)+'">\n                                    </div>\n                                  </a>\n                                </div>'):n.append('<div class="e-card_link">\n                                  <a href="'+DOL_URL_ROOT+"/contact/card.php?id="+e.taskResourceId+'" title="'+e.taskResourceName+'" target="_blank">\n                                    <div class="e-card_image">\n                                       <img class="e-image '+i+'" src="'+DOL_URL_ROOT+"/viewimage.php?modulepart=societe&file=contact/"+e.taskResourceId+"/photos/"+encodeURI(e.taskResourcePhoto)+'">\n                                    </div>\n                                  </a>\n                                </div>')})}void 0!==e.data.progress&&null!=e.data.progress||(e.data.progress="0%"),$(e.card).find("td.e-imagecell").prepend('<div class="progress-container" title="'+parseInt(e.data.progress)+'%"><div class="progress-value" style="width: '+parseInt(e.data.progress)+'%"></div></div>')}}).data("ejKanban"),transform(h).indexOf(k)<0&&window.setTimeout(function(){o.destroy()},100),l=$("#dlgTaskEdit").ejDialog({title:msgDlgTaskEditTitle,enableModal:!0,enableResize:!1,locale:locale,enableRTL:!1,showOnInit:!1,width:400}).data("ejDialog");var a=$("#dlgTaskEdit_sliderProgressChoice").ejSlider({sliderType:ej.SliderType.MinRange,showScale:!0,showSmallTicks:!1,height:20,width:350,value:0,minValue:0,maxValue:100,incrementStep:1,change:function(e){$("#dlgTaskEdit_sliderValue").text(e.model.value)},slide:function(e){$("#dlgTaskEdit_sliderValue").text(e.model.value)}}).data("ejSlider");$("#dlgTaskEdit_btnOK").ejButton({type:"button",size:"mini",showRoundedCorner:!0,click:function(e){if(transform(h).indexOf(k)<0)throw m;if(null!=s){var t=parseInt(s.progress),i=parseInt(a.getValue());i!==t&&v("dlgTaskEdit_btnOK_click",s.rowid,i)}}}),$("#dlgTaskEdit_btnCancel").ejButton({type:ej.ButtonType.Button,size:"mini",showRoundedCorner:!0,click:function(e){if(transform(g).indexOf(k)<0)throw m;null!=d&&(d.cancel=!0),l.close(),$("#kanbanTasks").find(".e-targetclone").remove(),$("body").css("cursor","default")}}),$("#fk_projet_input_filtre").on("change",function(e){""!=$(this).val()&&$("#fk_soc_input_filtre").val(""),e.stopPropagation()}),$("#fk_soc_input_filtre").on("change",function(e){""!=$(this).val()&&$("#fk_projet_input_filtre").val(""),e.stopPropagation()})}),window.onerror=function(e,t,i,n,a){return $("#waitingPopUp").ejWaitingPopup().data("ejWaitingPopup").hide(),console.log(e),!1};