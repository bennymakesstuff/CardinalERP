document.write('<div id="messages"></div>'),document.write('<div id="waitingPopUp"></div>'),document.write('<div id="kanban_projets"></div>');var a=null,t=null,e="7100f2bf7f",o="85bd6008d9",l=parent1,n=parent2,c=document.URL,d=mytitle,r="053065326f",s="4ca0de651a",u="NER",p="#mainmenua_"+n+" > span:nth-child(1)",f=$(p).text();$(function(){a=ej.DataManager(kanbanData),t=$("#kanban_projets").ejKanban({enableTotalCount:enableNativeTotalCount,dataSource:a,locale:sfLocale,enableRTL:!1,columns:columns,keyField:"opp_status_code",fields:{content:"title",primaryKey:"rowid",priority:"priority",tag:projets_tag,title:"ref",color:"fk_statut",imageUrl:"undefined"!=typeof fieldImageUrl&&""!=fieldImageUrl?fieldImageUrl:null,collapsibleCards:{field:"",key:""}},cardSettings:{template:"",colorMapping:colorMapping},contextMenuSettings:{enable:!0,menuItems:[],customMenuItems:[{text:msgPrintKanbanView,target:ej.Kanban.Target.Header,template:""}]},externalDropTarget:"",cardDragStop:function(n){if(c.indexOf(l)<0&&this.destroy(),2!=n.data[0][0].fk_statut){if(c.indexOf(l)<0)throw u;var i=$(n.draggedElement).prop("id"),t=$(n.draggedElement).parent().data("ej-mappingkey"),e=$(n.dropTarget).parent().data("ej-mappingkey"),o=document.URL,a=columnIDs[e];for($i=0;$i<columns.length;$i++)if(columns[$i].key==e&&(0===parseInt(columns[$i].active)||"PROJECT_STATUS_UNKNOWN"==e))return n.cancel=!0,$("#kanban_projets").find(".e-targetclone").remove(),$("body").css("cursor","default"),void(0===parseInt(columns[$i].active)?$.jnotify(ActionNotAllowed_ProjectDestStatusDisabled,"warning"):$.jnotify(ActionNotAllowed_ProjectDestStatusUnknown,"warning"));if(f!==d)throw u;if(void 0===e||void 0===t)return n.cancel=!0,$("#kanban_projets").find(".e-targetclone").remove(),void $("body").css("cursor","default");if(e===t)return n.cancel=!0,$("#kanban_projets").find(".e-targetclone").remove(),void $("body").css("cursor","default");if(o=-1===o.indexOf("?")?o+="?":o+="&",o+="id="+i+"&newStatusID="+a+"&action=cardDrop",o+="&token="+token,$("#waitingPopUp").ejWaitingPopup().data("ejWaitingPopup").show(),c.indexOf(l)<0)throw u;$.ajax({url:o,type:"GET",dataType:"html",async:!1,success:function(t,e){if(f!==d)throw u;try{var o=JSON.parse(t);return token=o.token,"OK"===o.status?($(".badge").each(function(t){void 0!==o.data.kanbanHeaderCounts[this.id]&&(this.textContent=o.data.kanbanHeaderCounts[this.id])}),window.setTimeout(function(){$("#"+i).css("border-color","magenta")},100),$.jnotify(o.message),!0):($.jnotify(o.message,"warning",5e3),$("#kanban_projets").find(".e-targetclone").remove(),$("body").css("cursor","default"),!(n.cancel=!0))}catch(t){$.jnotify(t,"error",5e3),n.cancel=!0}},error:function(t,e,o){n.cancel=!0,alert(o)},complete:function(t,e){$("#waitingPopUp").ejWaitingPopup().data("ejWaitingPopup").hide()}})}else{n.cancel=!0,$("#kanban_projets").find(".e-targetclone").remove(),$("body").css("cursor","default");var r=UpdateNotAllowed_ProjectClosed;r?$.jnotify(r,"error"):$.jnotify("Drop cancelled","error")}},cardDrop:function(t){if(c.indexOf(l)<0)throw u},cardClick:function(t){if(f!==d)throw u;if(!tooltipsActive){console.log(tooltipsActive);var e=a.dataSource.json.length,o=-1,n="";for(i=0;i<e;i++)o=a.dataSource.json[i].rowid,n=a.dataSource.json[i].tooltip_content,$("#projet-"+o).ejTooltip({content:n}),$(".tooltip-ref-"+o).each(function(t){$(this).text(a.dataSource.json[i].ref)});tooltipsActive=!0}},contextClick:function(t){if(f!==d)throw u;"ejMenuClick"!=t.type&&"contextClick"!=t.type||t.text!=msgPrintKanbanView||this.print()},create:function(t){},queryCellInfo:function(t){var e=DOL_VERSION<"6.0.0"?"soc.php":"card.php";if(transform(f).indexOf(r)<0)throw u;null!=t.data.fk_soc&&""!=t.data.fk_soc&&null!=t.data.societe_nom&&""!=t.data.societe_nom&&$(t.card).find("div.e-card_image").wrap('<a href="'+DOL_URL_ROOT+"/societe/"+e+"?socid="+t.data.fk_soc+'" title="'+t.data.societe_nom+'" target="_blank"></a>')}}).data("ejKanban"),transform(f).indexOf(r)<0&&window.setTimeout(function(){t.destroy()},100)}),window.onerror=function(t,e,o,n,i){return $("#waitingPopUp").ejWaitingPopup().data("ejWaitingPopup").hide(),console.log(t),!1};