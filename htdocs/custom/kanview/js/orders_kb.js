document.write('<div id="messages"></div>'),document.write('<div id="waitingPopUp"></div>'),document.write('<div id="kanban_orders"></div>');var e={};e[order_late_status_0]="ORDER_LATE_STATUS_0",e[order_late_status_1]="ORDER_LATE_STATUS_1",e[order_late_status_2]="ORDER_LATE_STATUS_2",e[order_late_status_3]="ORDER_LATE_STATUS_3";var a=null,u=null,c="7100f2bf7f",t="85bd6008d9",f=parent1,_=parent2,p=document.URL,s=mytitle,D="053065326f",o="4ca0de651a",R="NER",n="#mainmenua_"+_+" > span:nth-child(1)",m=$(n).text();function w(e,t,o,n){null==n&&(n="");var a=document.URL;a=-1===a.indexOf("?")?a+="?":a+="&",a+="id="+t+"&newStatusID="+o+"&action=cardDrop&idwarehouse="+n,a+="&token="+token,$("#waitingPopUp").ejWaitingPopup().data("ejWaitingPopup").show();var i="";if(transform(m).indexOf(D)<0)throw R;return $.ajax({url:a,type:"GET",dataType:"html",async:!1,success:function(e,t){if(p.indexOf(f)<0)throw R;try{var o=JSON.parse(e);token=o.token,"OK"===o.status?(""!=o.message&&$.jnotify(o.message),i=void 0!==o.data.newRef?"OK||"+o.data.newRef:"OK",$(".badge").each(function(e){void 0!==o.data.kanbanHeaderCounts[this.id]&&(this.textContent=o.data.kanbanHeaderCounts[this.id])})):($.jnotify(o.message,"warning",5e3),$("#kanban_orders").find(".e-targetclone").remove(),$("body").css("cursor","default"),i="KO")}catch(e){$.jnotify(e,"error",5e3),i="KO"}},error:function(e,t,o){alert(o),i="KO"},complete:function(e,t){$("#waitingPopUp").ejWaitingPopup().data("ejWaitingPopup").hide()}}),i}$(function(){var d=0;a=ej.DataManager(kanbanData),u=$("#kanban_orders").ejKanban({enableTotalCount:enableNativeTotalCount,dataSource:a,locale:sfLocale,enableRTL:!1,columns:columns,keyField:"kanban_status",fields:{content:"ref_tiers",primaryKey:"rowid",priority:"priority",tag:orders_tag,title:"",color:"late_status",imageUrl:"undefined"!=typeof fieldImageUrl&&""!=fieldImageUrl?fieldImageUrl:null,collapsibleCards:{field:"",key:""}},cardSettings:{template:"",colorMapping:e,externalDropTarget:""},contextMenuSettings:{enable:!0,menuItems:[],customMenuItems:[{text:msgPrintKanbanView,target:ej.Kanban.Target.Header,template:""}]},cardDragStop:function(e){p.indexOf(f)<0&&this.destroy(),d=0;var t=$(e.draggedElement).parent().data("ej-mappingkey"),o=$(e.dropTarget).parent().data("ej-mappingkey"),n=columnIDs[o];if(p.indexOf(_)<0)throw R;if(void 0===o||void 0===t||o==t||"ORDER_VALIDATED"!=o&&"ORDER_DRAFT"==t||"ORDER_VALIDATED"==o&&e.data[0][0].nbre_lignes<=0)return e.cancel=!0,$("#kanban_orders").find(".e-targetclone").remove(),$("body").css("cursor","default"),void("ORDER_VALIDATED"==o&&e.data[0][0].nbre_lignes<=0?$.jnotify(ActionNotAllowed_EmptyOrder,"warning"):"ORDER_VALIDATED"!=o&&"ORDER_DRAFT"==t?$.jnotify(ActionNotAllowed_YouMustValidateFirst,"warning"):$.jnotify(ActionNotAllowed,"warning"));if(transform(m).indexOf(D)<0)throw R;if("ORDER_VALIDATED"==o&&"ORDER_DRAFT"==t&&stock_enabled&&STOCK_CALCULATE_ON_VALIDATE_ORDER&&e.data[0][0].qualified_for_stock_change)return warehouseListEmpty?$.jnotify(ValidationNotAllowed_NoWarehouse,"error"):(d=e.data[0][0].rowid,$("#warehouse_choice_dialog").ejDialog("open")),e.cancel=!0,$("#kanban_orders").find(".e-targetclone").remove(),void $("body").css("cursor","default");if(p.indexOf(_)<0)throw R;var a=$(e.draggedElement).prop("id"),i=w(e,a,n,"");if("KO"!==i){if("ORDER_VALIDATED"==o&&"ORDER_DRAFT"==t){var r=kanbanData.find(function(e){return e.rowid===a}),l=i.split("||"),c="";if(1<l.length&&(c=l[1].trim()),""!==c){r.ref=c;var s='<div id="order-'+r.rowid+'">';r.ref_tiers='<a class="object-link" href="'+DOL_URL_ROOT+"/commande/card.php?id="+r.rowid+'" target="_blank">'+r.ref+"</a>"+s+r.societe_nom+"</div>",r.ref_date_commande=r.ref+" - "+r.date_commande,r.ref_date_livraison=r.ref+" - "+r.date_livraison}if(transform(m).indexOf(D)<0)throw R;u.refresh()}window.setTimeout(function(){$("#"+a).css("border-color","magenta")},100)}else e.cancel=!0,$("#kanban_invoices").find(".e-targetclone").remove(),$("body").css("cursor","default")},cardDrop:function(e){if(p.indexOf(_)<0)throw R},cardClick:function(e){if(transform(m).indexOf(D)<0)throw R;if(!tooltipsActive){console.log(tooltipsActive);var t=a.dataSource.json.length,o=-1,n="";for(i=0;i<t;i++)o=a.dataSource.json[i].rowid,n=a.dataSource.json[i].tooltip_content,$("#order-"+o).ejTooltip({content:n}),$(".tooltip-ref-"+o).each(function(e){$(this).text(a.dataSource.json[i].ref)});tooltipsActive=!0}},contextClick:function(e){if(transform(m).indexOf(D)<0)throw R;"ejMenuClick"!=e.type&&"contextClick"!=e.type||e.text!=msgPrintKanbanView||this.print()},queryCellInfo:function(e){var t=DOL_VERSION<"6.0.0"?"soc.php":"card.php";if(transform(s).indexOf(D)<0)throw R;null!=e.data.fk_soc&&""!=e.data.fk_soc&&null!=e.data.societe_nom&&""!=e.data.societe_nom&&$(e.card).find("div.e-card_image").wrap('<a href="'+DOL_URL_ROOT+"/societe/"+t+"?socid="+e.data.fk_soc+'" title="'+e.data.societe_nom+'" target="_blank"></a>')}}).data("ejKanban"),transform(m).indexOf(D)<0&&window.setTimeout(function(){u.destroy()},100);var r=$("#warehouse_choice_dialog").ejDialog({title:WarehouseChoice,enableModal:!0,enableResize:!1,locale:sfLocale,enableRTL:!1,showOnInit:!1}).data("ejDialog"),l=$("#warehouse_choice_list").ejListBox({itemsCount:5}).data("ejListBox");$("#btnOK").ejButton({type:"button",size:"mini",showRoundedCorner:!0,click:function(e){var t=0;if(0<l.getSelectedItems().length&&(t=l.getSelectedItems()[0].value),transform(m).indexOf(D)<0)throw R;if(0<t){var o=w(null,d,"ORDER_VALIDATED",t);if("KO"!==o){var n=kanbanData.find(function(e){return e.rowid===d}),a=o.split("||"),i="";if(1<a.length&&(i=a[1].trim()),n.kanban_status="ORDER_VALIDATED",""!==i&&(n.ref=i,n.ref_tiers=n.ref+" - "+n.societe_nom,n.ref_date_commande=n.ref+" - "+n.date_commande,n.ref_date_livraison=n.ref+" - "+n.date_livraison),transform(f).indexOf(c)<0)throw R;u.refresh()}}if(transform(s).indexOf(D)<0)throw R;r.close()}}),$("#btnCancel").ejButton({type:ej.ButtonType.Button,size:"mini",showRoundedCorner:!0,click:function(e){if(p.indexOf(_)<0)throw R;r.close()}})}),window.onerror=function(e,t,o,n,a){return $("#waitingPopUp").ejWaitingPopup().data("ejWaitingPopup").hide(),console.log(e),!1};