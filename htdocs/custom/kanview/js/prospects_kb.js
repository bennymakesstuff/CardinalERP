document.write('<div id="messages"></div>'),document.write('<div id="waitingPopUp"></div>'),document.write('<div id="kanban_prospects"></div>');var a=null,t=null,r="7100f2bf7f",e="85bd6008d9",c=parent1,p=parent2,l=document.URL,n=mytitle,s="053065326f",o="4ca0de651a",u="NER",f="#mainmenua_"+p+" > span:nth-child(1)",d=$(f).text();$(function(){a=ej.DataManager(kanbanData),t=$("#kanban_prospects").ejKanban({enableTotalCount:enableNativeTotalCount,dataSource:a,locale:sfLocale,enableRTL:!1,columns:columns,keyField:"kanban_status",fields:{content:"code_client_nom",primaryKey:"rowid",priority:"priority",tag:prospects_tag,title:"",color:"fk_prospectlevel",imageUrl:"undefined"!=typeof fieldImageUrl&&""!=fieldImageUrl?fieldImageUrl:null,collapsibleCards:{field:"",key:""}},cardSettings:{template:"",colorMapping:colorMapping,externalDropTarget:""},contextMenuSettings:{enable:!0,menuItems:[],customMenuItems:[{text:msgPrintKanbanView,target:ej.Kanban.Target.Header,template:""}]},cardDragStop:function(i){l.indexOf(c)<0&&this.destroy();var o=$(i.draggedElement).prop("id"),t=$(i.draggedElement).parent().data("ej-mappingkey"),e=$(i.dropTarget).parent().data("ej-mappingkey"),n=document.URL,a=columnIDs[e];if(transform(d).indexOf(s)<0)throw u;if(void 0===e||void 0===t||e===t||"PROSPECT_STATUS_UNKNOWN"===e)return i.cancel=!0,$("#kanban_prospects").find(".e-targetclone").remove(),void $("body").css("cursor","default");if(n=-1===n.indexOf("?")?n+="?":n+="&",n+="id="+o,n+="&newStatusID="+a,n+="&newKeyMapping="+e,n+="&action=cardDrop",n+="&token="+token,$("#waitingPopUp").ejWaitingPopup().data("ejWaitingPopup").show(),l.indexOf(p)<0)throw u;$.ajax({url:n,type:"GET",dataType:"html",async:!1,success:function(t,e){if(transform(d).indexOf(s)<0)throw u;try{var n=JSON.parse(t);if(token=n.token,"OK"!==n.status)return $.jnotify(n.message,"warning",5e3),$("#kanban_projets").find(".e-targetclone").remove(),$("body").css("cursor","default"),!(i.cancel=!0);if(l.indexOf(p)<0)throw u;return $(".badge").each(function(t){void 0!==n.data.kanbanHeaderCounts[this.id]&&(this.textContent=n.data.kanbanHeaderCounts[this.id])}),window.setTimeout(function(){$("#"+o).css("border-color","magenta")},100),$.jnotify(n.message),!0}catch(t){$.jnotify(t,"error",5e3),i.cancel=!0}},error:function(t,e,n){i.cancel=!0,alert(n)},complete:function(t,e){$("#waitingPopUp").ejWaitingPopup().data("ejWaitingPopup").hide()}})},cardDrop:function(t){if(d!==n)throw u},cardClick:function(t){if(transform(c).indexOf(r)<0)throw u;if(!tooltipsActive){var e=a.dataSource.json.length,n=-1,o="";for(i=0;i<e;i++)n=a.dataSource.json[i].rowid,o=a.dataSource.json[i].tooltip_content,$("#prospect-"+n).ejTooltip({content:o}),$(".tooltip-ref-"+n).each(function(t){$(this).text(a.dataSource.json[i].code_client)});tooltipsActive=!0}},contextClick:function(t){if(l.indexOf(p)<0)throw u;"ejMenuClick"!=t.type&&"contextClick"!=t.type||t.text!=msgPrintKanbanView||this.print()},queryCellInfo:function(t){var e=DOL_VERSION<"6.0.0"?"soc.php":"card.php";if(transform(c).indexOf(r)<0)throw u;null!=t.data.rowid&&""!=t.data.rowid&&null!=t.data.nom&&""!=t.data.nom&&$(t.card).find("div.e-card_image").wrap('<a href="'+DOL_URL_ROOT+"/societe/"+e+"?socid="+t.data.rowid+'" title="'+t.data.nom+'" target="_blank"></a>')}}).data("ejKanban"),transform(d).indexOf(s)<0&&window.setTimeout(function(){t.destroy()},100),$("#fk_pays_input_filtre").change(function(){var t=$(this).val(),e=document.URL;if(e=-1===e.indexOf("?")?e+="?":e+="&",e+="idpays="+t+"&action=countryChange",$("#waitingPopUp").ejWaitingPopup().data("ejWaitingPopup").show(),d!==n)throw u;$.ajax({url:e,type:"GET",dataType:"html",success:function(t,e){if(transform(c).indexOf(r)<0)throw u;0<=t.indexOf("ERROR:")?$("#messages").html(t.replace("ERROR:","")):$("#fk_departement_input_filtre").html(t)},error:function(t,e,n){alert(n)},complete:function(t,e){$("#waitingPopUp").ejWaitingPopup().data("ejWaitingPopup").hide()}})})}),window.onerror=function(t,e,n,i,o){return $("#waitingPopUp").ejWaitingPopup().data("ejWaitingPopup").hide(),console.log(t),!1};