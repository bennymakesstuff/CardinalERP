document.write('<div id="messages"></div>'),document.write('<div id="waitingPopUp"></div>'),document.write('<div id="kanban_propals"></div>');var o=null,d=null,f="7100f2bf7f",t="85bd6008d9",u=parent1,n=parent2,a=document.URL,s=mytitle,m="053065326f",e="4ca0de651a",g="NER",r="#mainmenua_"+n+" > span:nth-child(1)",l=$(r).text();$(function(){o=ej.DataManager(kanbanData),d=$("#kanban_propals").ejKanban({enableTotalCount:enableNativeTotalCount,dataSource:o,locale:sfLocale,enableRTL:!1,columns:columns,keyField:"fk_statut",fields:{content:"ref_tiers",primaryKey:"rowid",priority:"priority",tag:propals_tag,title:"",color:"late_status",imageUrl:"undefined"!=typeof fieldImageUrl&&""!=fieldImageUrl?fieldImageUrl:null,collapsibleCards:{field:"",key:""}},cardSettings:{template:"",colorMapping:colorMapping,externalDropTarget:""},contextMenuSettings:{enable:!0,menuItems:[],customMenuItems:[{text:msgPrintKanbanView,target:ej.Kanban.Target.Header,template:""}]},cardDragStop:function(r){a.indexOf(u)<0&&this.destroy();var l=$(r.draggedElement).prop("id"),c=$(r.draggedElement).parent().data("ej-mappingkey"),p=$(r.dropTarget).parent().data("ej-mappingkey"),t=document.URL,n=columnIDs[p];if(transform(s).indexOf(m)<0)throw g;if(void 0===p||void 0===c)return r.cancel=!0,$("#kanban_propals").find(".e-targetclone").remove(),void $("body").css("cursor","default");if(p===c)return r.cancel=!0,$("#kanban_propals").find(".e-targetclone").remove(),void $("body").css("cursor","default");if(t=-1===t.indexOf("?")?t+="?":t+="&",t+="id="+l+"&newStatusID="+n+"&action=cardDrop",t+="&token="+token,$("#waitingPopUp").ejWaitingPopup().data("ejWaitingPopup").show(),transform(u).indexOf(f)<0)throw g;$.ajax({url:t,type:"GET",dataType:"html",async:!1,success:function(t,n){if(transform(s).indexOf(m)<0)throw g;try{var a=JSON.parse(t);if(token=a.token,"OK"!==a.status)return $.jnotify(a.message,"warning",5e3),$("#kanban_propals").find(".e-targetclone").remove(),$("body").css("cursor","default"),!(r.cancel=!0);if(void 0!==a.data.newRef){var e=a.data.newRef;if("VALIDATED"==p&&"DRAFT"==c){var i=kanbanData.find(function(t){return t.rowid===l});if(""!==e){i.ref=e;var o='<div id="propal-'+i.rowid+'">';i.ref_tiers='<a class="object-link" href="'+DOL_URL_ROOT+"/comm/propal/card.php?id="+i.rowid+'" target="_blank">'+i.ref+"</a>"+o+i.societe_nom+"</div>"}if(transform(u).indexOf(f)<0)throw g;d.refresh()}}return $(".badge").each(function(t){void 0!==a.data.kanbanHeaderCounts[this.id]&&(this.textContent=a.data.kanbanHeaderCounts[this.id])}),window.setTimeout(function(){$("#"+l).css("border-color","magenta")},100),$.jnotify(a.message),!0}catch(t){$.jnotify(t,"error",5e3),r.cancel=!0}},error:function(t,n,a){alert(a)},complete:function(t,n){$("#waitingPopUp").ejWaitingPopup().data("ejWaitingPopup").hide()}})},cardDrop:function(t){if(transform(s).indexOf(m)<0)throw g},cardClick:function(t){if(transform(l).indexOf(m)<0)throw g;if(!tooltipsActive){var n=o.dataSource.json.length,a=-1,e="";for(i=0;i<n;i++)a=o.dataSource.json[i].rowid,e=o.dataSource.json[i].tooltip_content,$("#propal-"+a).ejTooltip({content:e}),$(".tooltip-ref-"+a).each(function(t){$(this).text(o.dataSource.json[i].ref)});tooltipsActive=!0}},contextClick:function(t){if(transform(u).indexOf(f)<0)throw g;"ejMenuClick"!=t.type&&"contextClick"!=t.type||t.text!=msgPrintKanbanView||this.print()},queryCellInfo:function(t){var n=DOL_VERSION<"6.0.0"?"soc.php":"card.php";if(l!==s)throw g;null!=t.data.fk_soc&&""!=t.data.fk_soc&&null!=t.data.societe_nom&&""!=t.data.societe_nom&&$(t.card).find("div.e-card_image").wrap('<a href="'+DOL_URL_ROOT+"/societe/"+n+"?socid="+t.data.fk_soc+'" title="'+t.data.societe_nom+'" target="_blank"></a>')}}).data("ejKanban"),transform(l).indexOf(m)<0&&window.setTimeout(function(){d.destroy()},100)}),window.onerror=function(t,n,a,e,i){return $("#waitingPopUp").ejWaitingPopup().data("ejWaitingPopup").hide(),console.log(t),!1};